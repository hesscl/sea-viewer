---
title: "sea-viewer"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: bootstrap
    logo: logo.svg
    source_code: "https://github.com/hesscl/sea-viewer"
---


```{r setup, echo = FALSE, include = FALSE}
library(flexdashboard)
library(tidyverse)
library(sqldf)
library(dygraphs)
library(lubridate)
library(imputeTS)
library(plotly)
library(xts)
library(highcharter)
library(forecast)
library(rgdal)
library(leaflet)
library(spdplyr)
library(zoo)
library(DT)

#data
DB <- dbConnect(SQLite(), dbname="../data/cl/craigslistDB.sqlite")
clean <- tbl(DB, "clean") #clean seattle listing table
tract <- tbl(DB, "tract")

#query the clean table, re-establish date classes, de-dupe
cl <- clean %>% 
  filter(listingDate > "2017-02-06") %>%
  collect %>% 
  mutate(listingDate = as.Date(listingDate),
         listingMoYr = as.Date(listingMoYr)) %>%
  mutate(catSqft = fct_reorder(catSqft, cleanSqft)) %>%
  filter(!is.na(cleanBeds), !is.na(cleanRent), !is.na(cleanSqft), !is.na(matchAddress)) %>%
  filter(listingDate != Sys.Date()) %>% #since day-of is incomplete
  distinct(matchAddress, matchAddress2, cleanBeds, cleanRent, cleanSqft, .keep_all = T)

#query the tract geography table
wash <- tract %>%
  filter(STATEFP10 == 53, COUNTYFP10 == 33) %>%
  collect

#load shapefiles
sea_shp <- readOGR(dsn = "../data/geo/sea_tract_2010/sea_tract_2010.shp",
               layer = "sea_tract_2010",
               GDAL1_integer64_policy = TRUE,
               stringsAsFactors = F, verbose = F)

kc_shp <- readOGR(dsn = "../data/geo/KCTract2010/KCTract2010.shp",
                  layer = "KCTract2010",
                  GDAL1_integer64_policy = TRUE,
                  stringsAsFactors = F, verbose = F)

neigh_shp <- readOGR(dsn = "../data/geo/neighborhoods/WGS84/neighborhoods.shp",
                  layer = "neighborhoods",
                  GDAL1_integer64_policy = TRUE,
                  stringsAsFactors = F, verbose = F)
neigh_shp <- neigh_shp %>%
  mutate(HOOD = ifelse(L_HOOD == "NO BROADER TERM", toupper(S_HOOD), L_HOOD))

#prep `cl` and `neigh_shp` for spatial intersect
coordinates(cl) <- cbind(cl$lng, cl$lat)
proj4string(cl) <- CRS("+proj=longlat +datum=WGS84")
neigh_shp <- spTransform(neigh_shp, CRS("+proj=longlat +datum=WGS84"))

#append clerk's office neigh defs
L_HOOD <- over(cl, neigh_shp[,"L_HOOD"])
S_HOOD <- over(cl, neigh_shp[,"S_HOOD"])
HOOD <- over(cl, neigh_shp[,"HOOD"])
cl <- bind_cols(cl@data, L_HOOD, S_HOOD, HOOD)

#functions for widgets
computeListings <- function(x){
  y <- x %>% 
    filter(listingDate %in% seq(Sys.Date()-30, Sys.Date(), by = 1)) %>%
    group_by(listingDate) %>%
    summarize(n = n()) %>%
    summarize(median = median(n)) %>%
    pull(median)
  y <- prettyNum(y, big.mark = ",")
  return(y)
}

computeKCMedian30 <- function(x){
  y <- x %>% 
    filter(listingDate %in% seq(Sys.Date()-30, Sys.Date(), by = 1)) %>%
    summarize(median = median(cleanRent)) %>%
    pull(median)
  y <- prettyNum(y, big.mark = ",")
  return(y)
}

computeSeaMedian30 <- function(x){
  y <- x %>% 
    filter(listingDate %in% seq(Sys.Date()-30, Sys.Date(), by = 1)) %>%
    filter(seattle == 1) %>%
    summarize(median = median(cleanRent)) %>%
    pull(median)
  y <- prettyNum(y, big.mark = ",")
  return(y)
}

#function for Overview graphic
computeTS <- function(x){
  y <- x %>%
    group_by(listingDate) %>%
    summarize(median = median(cleanRent))
  
 fullDates <- seq(from = min(y$listingDate), to = max(y$listingDate), by = 1)
 index <- seq(from = 1, length.out = length(fullDates), by = 1)
 dateTable <- cbind.data.frame(fullDates, index)
 
 medRent <- NULL
  for(i in 1:length(fullDates)){
    if(fullDates[i] %in% y$listingDate){
      medRent[i] <- y$median[y$listingDate == fullDates[i]]
    } else{
      medRent[i] <- NA
    }
  }
  ts <- cbind.data.frame(medRent, fullDates)
  ts <- na.interpolation(ts, option = "linear")
  ts <- zoo(ts$medRent, order.by = fullDates) %>% as.xts
  return(ts)
}

compute90 <- function(x){
  y <- x %>%
  filter(listingDate %in% seq(Sys.Date()-91, Sys.Date()-1, 1)) %>%
  group_by(catBeds) %>%
  summarize(n = n(),
            quant0.025 = prettyNum(round(quantile(cleanRent, .025)), big.mark = ","),
            medRent = prettyNum(round(median(cleanRent)), big.mark = ","),
            quant0.975 = prettyNum(round(quantile(cleanRent, .975)), big.mark = ","),
            medRentPerSqft =prettyNum(round(median(cleanRent/cleanSqft), 2), big.mark = ","))
  return(y)
}

aggTrends <- function(x){
  y <- x %>%
    filter(catBeds != "5+") %>%
    mutate(listingMoYr = as.Date(as.character(listingMoYr))) %>%
    group_by(listingMoYr, catBeds) %>%
    summarize(medRent = median(cleanRent),
              n = n())
  return(y)
}

prepShape <- function(x, bed.type = "1", shp = NULL, group = "GEOID10"){
  y <- cl %>%
    filter(catBeds == bed.type) %>%
    mutate(GEOID10 = as.character(GEOID10)) %>%
    group_by_(group) %>% 
    summarize(n = n(),
              medRent = median(cleanRent)) %>%
    filter(n > 15)
  
  shp <- left_join(shp, y)
}

ts_thm <- hc_theme_merge(
  hc_theme_google(),
  hc_theme(colors = RColorBrewer::brewer.pal(3, "Set1")[-1]))

sea_thm <- hc_theme_merge(
  hc_theme_google(),
  hc_theme(colors = RColorBrewer::brewer.pal(5, "Blues")[-1]))

kc_thm <- hc_theme_merge(
  hc_theme_google(),
  hc_theme(colors = RColorBrewer::brewer.pal(5, "Greens")[-1]))

```

Home {data-icon="fa-home"}
=====================================

Row
-------------------------------------

### Welcome!

This website provides the latest information from the UW team's rental market database. The navigation bar provides access to detailed reports for Seattle, King County and specific neighborhoods.

Contact the project team at [searent@uw.edu](mailto://searent@uw.edu) for more information about this report or to suggest new features.


Row
-------------------------------------

### Daily median rent time-series (30-day rolling average)

```{r overview.ts, echo = FALSE, warning = F, message = F, dpi = 300}
ts <- computeTS(cl)
ts_sea <- computeTS(cl %>% filter(seattle == 1))

ts <- xts(rollapply(as.zoo(ts), FUN = mean, 30, na.rm = T, partial = T))
ts_sea <- xts(rollapply(as.zoo(ts_sea), FUN = mean, 30, na.rm = T, partial = T))

mts <- cbind(ts_sea, ts)

highchart() %>%
  hc_yAxis(title = list(text = "Median Listing Rent"), opposite = F) %>%
  hc_xAxis(date = seq(min(date(mts)), max(date(mts)), 1) %>% as_datetime) %>% 
  hc_add_series_xts(mts[,1], name = "Seattle") %>%
  hc_add_series_xts(mts[,2], name = "King County") %>%
  hc_tooltip(pointFormat = "<b>{series.name}</b> <br> Rent: {point.y:%.0f}") %>%
  hc_add_theme(ts_thm) %>%
  hc_exporting(enabled = TRUE)

```

Row
-------------------------------------

### Seattle median listings/day (past 30 days)

```{r overview.list}
listings <- computeListings(cl %>% filter(seattle == 1))
valueBox(listings,
         color = "secondary",
         icon = "fa-building")
```

### Seattle median listing rent (past 30 days) 

```{r overview.seamed}
median <- computeSeaMedian30(cl)
valueBox(paste0("\U0024", median), 
         color = "secondary",
         icon = "fa-dollar")
```

### King County median listing rent (past 30 days)

```{r overview.kcmed}
median <- computeKCMedian30(cl)
valueBox(paste0("\U0024", median),
         color = "secondary",
         icon = "fa-dollar")
```



Overview {data-navmenu="Seattle"}
=====================================

Row
-------------------------------------

### 90-day summary for Seattle listings

```{r sea.90day}
DT::datatable(compute90(cl %>% filter(seattle == 1)),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```


Row
-------------------------------------

### Trend analysis

```{r sea.trend}
agg_sea <- aggTrends(cl %>% filter(seattle == 1, catBeds %in% c("0", "1", "2", "3")))

hchart(agg_sea, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)

```


0B Rent Map  {data-navmenu="Seattle"}
=====================================

```{r, sea.0Bmap, warning = FALSE}
sea_map <- prepShape(x = cl, bed.type = "0", shp = sea_shp)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 0B Rent: %g",
  sea_map$NAMELSAD10, sea_map$medRent
) %>% lapply(htmltools::HTML)

pal <- colorBin("Blues", domain = sea_map@data$medRent, bins = 6)

leaflet(sea_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "0B Median Rent",
  position = "bottomright")
```


1B Rent Map  {data-navmenu="Seattle"}
=====================================

```{r, sea.1Bmap, warning = FALSE}
sea_map <- prepShape(x = cl, bed.type = "1", shp = sea_shp)

pal <- colorBin("Blues", domain = sea_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 1B Rent: %g",
  sea_map$NAMELSAD10, sea_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(sea_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "1B Median Rent",
  position = "bottomright")
```


2B Rent Map  {data-navmenu="Seattle"}
=====================================

```{r, sea.2Bmap, warning = FALSE}
sea_map <- prepShape(x = cl, bed.type = "2", shp = sea_shp)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 2B Rent: %g",
  sea_map$NAMELSAD10, sea_map$medRent
) %>% lapply(htmltools::HTML)

pal <- colorBin("Blues", domain = sea_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 2B Rent: %g",
  sea_map$NAMELSAD10, sea_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(sea_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "2B Median Rent",
  position = "bottomright")
```


3B Rent Map  {data-navmenu="Seattle"}
=====================================

```{r sea.3Bmap, warning = FALSE}
sea_map <- prepShape(x = cl, bed.type = "3", shp = sea_shp)

pal <- colorBin("Blues", domain = sea_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 3B Rent: %g",
  sea_map$NAMELSAD10, sea_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(sea_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "3B Median Rent",
  position = "bottomright")
```


Overview  {data-navmenu="King County"}
=====================================

Row
-------------------------------------

### 90-day summary for King County listings

```{r kc.90day}
DT::datatable(compute90(cl),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
```


Row
-------------------------------------

### Trend analysis

```{r, kc.trend}
agg_kc <- aggTrends(cl %>% filter(catBeds %in% c("0", "1", "2", "3")))

hchart(agg_kc, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(kc_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```


0B Rent Map  {data-navmenu="King County"}
=====================================

```{r, kc.0Bmap, warning = FALSE}
kc_map <- prepShape(x = cl, bed.type = "0", shp = kc_shp)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 0B Rent: %g",
  kc_map$NAMELSAD10, kc_map$medRent
) %>% lapply(htmltools::HTML)

pal <- colorBin("Blues", domain = kc_map@data$medRent, bins = 6)

leaflet(kc_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "0B Median Rent",
  position = "bottomright")
```


1B Rent Map  {data-navmenu="King County"}
=====================================

```{r, kc.1Bmap, warning = FALSE}
kc_map <- prepShape(x = cl, bed.type = "1", shp = kc_shp)

pal <- colorBin("Greens", domain = kc_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 1B Rent: %g",
  kc_map$NAMELSAD10, kc_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(kc_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "1B Median Rent",
  position = "bottomright")
```


2B Rent Map  {data-navmenu="King County"}
=====================================

```{r, kc.2Bmap, warning = FALSE}
kc_map <- prepShape(x = cl, bed.type = "2", shp = kc_shp)

pal <- colorBin("Greens", domain = kc_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 2B Rent: %g",
  kc_map$NAMELSAD10, kc_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(kc_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "2B Median Rent",
  position = "bottomright")
```


3B Rent Map  {data-navmenu="King County"}
=====================================

```{r kc.3Bmap, warning = FALSE}
kc_map <- prepShape(x = cl, bed.type = "3", shp = kc_shp)

pal <- colorBin("Greens", domain = kc_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 3B Rent: %g",
  kc_map$NAMELSAD10, kc_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(kc_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "3B Median Rent",
  position = "bottomright")
```

1B Map {data-navmenu="Neighborhoods"}
=====================================

```{r, neigh.1Bmap, warning = FALSE}
neigh_map <- prepShape(x = cl, bed.type = "1", shp = neigh_shp, group = "HOOD")

pal <- colorBin("Blues", domain = neigh_map@data$medRent, bins = 6)

labels <- sprintf(
  "<strong>%s</strong><br/>Median 1B Rent: %g",
  neigh_map$HOOD, neigh_map$medRent
) %>% lapply(htmltools::HTML)

leaflet(neigh_map) %>%
  setView(lng = -122.332460, lat = 47.610629, zoom = 11) %>%
  addProviderTiles(providers$CartoDB.Positron) %>%
  addPolygons(color = "#444444", weight = 1, smoothFactor = 0.5,
              opacity = 1.0, fillOpacity = 0.5, 
              fillColor = ~pal(medRent),
              highlight = highlightOptions(
                              weight = 5,
                              color = "#666",
                              dashArray = "",
                              fillOpacity = 0.7,
                              bringToFront = TRUE),
                label = labels,
                labelOptions = labelOptions(
                                    style = list("font-weight" = "normal", padding = "3px 8px"),
                                    textsize = "15px",
                                    direction = "auto")) %>%
  addLegend(pal = pal, values = ~medRent, opacity = 0.7, title = "1B Median Rent",
  position = "bottomright")
```


Ballard {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r ballard.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "BALLARD")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r ballard.trend}
agg_ball <- aggTrends(cl %>% filter(L_HOOD == "BALLARD", catBeds %in% c("0", "1", "2")))

hchart(agg_ball, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```



Beacon Hill {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r beacon.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "BEACON HILL")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r beacon.trend}
agg_beac <- aggTrends(cl %>% filter(L_HOOD == "BEACON HILL", catBeds %in% c("0", "1", "2")))

hchart(agg_beac, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```


Capitol Hill {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r capitol.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "CAPITOL HILL")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r capitol.trend}
agg_cap <- aggTrends(cl %>% filter(L_HOOD == "CAPITOL HILL", catBeds %in% c("0", "1", "2")))

hchart(agg_cap, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```

Central District {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r central.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "CENTRAL AREA")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r central.trend}
agg_cent <- aggTrends(cl %>% filter(L_HOOD == "CENTRAL AREA", catBeds %in% c("0", "1", "2")))

hchart(agg_cent, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```


Delridge {data-navmenu="Neighborhoods"}
=====================================


Row
-------------------------------------

### 90-day summary

```{r delridge.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "DELRIDGE")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r delridge.trend}
agg_del <- aggTrends(cl %>% filter(L_HOOD == "DELRIDGE", catBeds %in% c("0", "1", "2")))

hchart(agg_del, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```




Downtown {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r downtown.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "DOWNTOWN")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r downtown.trend}
agg_down <- aggTrends(cl %>% filter(L_HOOD == "DOWNTOWN", catBeds %in% c("0", "1", "2")))

hchart(agg_down, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```




Lake City {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r lakecity.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "LAKE CITY")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r lakecity.trend}
agg_lake <- aggTrends(cl %>% filter(L_HOOD == "LAKE CITY", catBeds %in% c("0", "1", "2")))

hchart(agg_lake, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```

Magnolia {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r magnolia.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "MAGNOLIA")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r magnolia.trend}
agg_magnolia <- aggTrends(cl %>% filter(L_HOOD == "MAGNOLIA", catBeds %in% c("0", "1", "2")))

hchart(agg_magnolia, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```




Northgate {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r northgate.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "NORTHGATE")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r northgate.trend}
agg_north <- aggTrends(cl %>% filter(L_HOOD == "NORTHGATE", catBeds %in% c("0", "1", "2")))

hchart(agg_north, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```


Queen Anne {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r queenanne.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "QUEEN ANNE")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r queenanne.trend}
agg_queen <- aggTrends(cl %>% filter(L_HOOD == "QUEEN ANNE", catBeds %in% c("0", "1", "2")))

hchart(agg_queen, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE)
```

Rainier Valley {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r rainier.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "RAINIER VALLEY")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r rainier.trend}
agg_rainier <- aggTrends(cl %>% filter(L_HOOD == "RAINIER VALLEY", catBeds %in% c("0", "1", "2")))

hchart(agg_rainier, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE) 
```

Seward Park {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r seward.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "SEWARD PARK")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r seward.trend}
agg_seward <- aggTrends(cl %>% filter(L_HOOD == "SEWARD PARK", catBeds %in% c("0", "1", "2", "3")))

hchart(agg_seward, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE) 
```

University District {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r udistrict.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "UNIVERSITY DISTRICT")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r udistrict.trend}
agg_udist <- aggTrends(cl %>% filter(L_HOOD == "UNIVERSITY DISTRICT", catBeds %in% c("0", "1", "2")))

hchart(agg_udist, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE) 
```


West Seattle {data-navmenu="Neighborhoods"}
=====================================

Row
-------------------------------------

### 90-day summary

```{r west.90day}
DT::datatable(compute90(cl %>% filter(L_HOOD == "WEST SEATTLE")),
              rownames = F,
              colnames = c("Bedroom Size", "N Listings", "2.5% Quantile", "Median Rent", "97.5% Quantile", "Median Rent/Sqft"),
              class = "cell-border stripe",
              style = "bootstrap",
              autoHideNavigation = T,
              extensions = 'Buttons', 
              options = list(dom = 'Bfrtip',
                             buttons = c('copy', 'csv', 'excel', 'pdf', 'print'),
                             paging = F,
                             searching = F,
                             autoWidth = T,
                             columnDefs = list(list(className = 'dt-right', targets = 1:5,
                                                    width = "16.66%"))
))
              
```

Row
-------------------------------------

### Trend Analysis

```{r west.trend}
agg_west <- aggTrends(cl %>% filter(L_HOOD == "WEST SEATTLE", catBeds %in% c("0", "1", "2")))

hchart(agg_west, type = "line",
       hcaes(x = listingMoYr, y = medRent, group = catBeds)) %>%
  hc_yAxis(title = list(text = "Median Listing Rent")) %>%
  hc_xAxis(title = list(text = "Month")) %>%
  hc_add_theme(sea_thm)  %>%
  hc_tooltip(pointFormat = "<b>{series.name} Bedroom Units</b> <br> Rent: {point.y:%.0f} <br> N Listings: {point.n}") %>%
  hc_exporting(enabled = TRUE) 
```



